

# 

1. How is the tree represented in an array? 


2. How are the leaves stored and what format? 

```
Leaves: [array([[-2.98042101e+02, -8.38632241e+01, -8.18662191e+00,
         1.38791646e+01, -2.29637412e+01,  2.26290946e+00,
        -1.00635310e+00,  1.86364249e+00],

       [-2.88887737e+02, -8.35321184e+01, -7.53240821e+00,
         1.50017053e+01, -2.43169210e+01,  2.25997425e+00,
         2.83608103e+00,  5.37344469e+00],
       
       [-2.76242474e+02, -7.09388406e+01, -3.63197613e+00,
         6.42673310e+01, -2.73578567e+01,  1.23367403e-01,
        -6.36905962e+00, -9.05103046e+00],
       
       [-2.81562027e+02, -5.04291319e+01, -6.32096389e+00,
         3.74430609e+01, -3.41724559e+01,  1.95054138e+00,
         5.01781987e+00,  9.19437026e+00],
       
       [-2.89534915e+02, -4.97547034e+01, -8.00091157e+00,
         6.01704373e+01, -5.17796994e+01, -3.42406679e+01,
        -2.82223008e+00,  1.28870043e+01],
       
       [-2.99440848e+02, -4.09618258e+01, -6.09442934e+00,
         3.07466328e+01, -4.35838747e+01,  1.50871649e-01,
        -6.84401031e-01,  5.71471896e+00],
       [-2.68000001e+02, -3.96405758e+01, -5.81335535e+00,
         3.21878854e+01, -5.89179901e+01, -5.60591770e+00,
        -3.79442243e+00, -2.67654967e+00],
       [-2.77051242e+02, -3.67240945e+01, -7.09791391e+00,
         1.37947140e+01, -8.00398097e+01, -2.22327076e+01,
        -1.65586478e+01, -5.89103577e-01],
       [-2.72069911e+02, -3.62631853e+01, -4.40335836e+00,
         3.04125123e+01, -5.87864766e+01, -6.58854714e-01,
        -5.94133464e+00,  1.70052898e+00],
       [-2.94844781e+02, -3.24090125e+01, -6.27479010e+00,
         2.41486913e+01, -4.28857466e+01, -5.23020341e+00,
        -2.12609565e+00, -3.80329759e+00],
       [-3.20014808e+02, -3.14200017e+01, -5.87165341e+00,
         2.21029283e+01, -4.90587942e+01, -1.22365872e+00,
        -6.01019839e+00,  2.51086971e+00],
       [-2.78631458e+02, -3.06254215e+01, -5.62088718e+00,
         9.90306631e+00, -6.03809665e+01,  1.76301570e+00,
        -1.06265341e+01, -9.14879043e-01],
       [-2.78052713e+02, -3.04462429e+01, -5.93775561e+00,
         9.80362618e+00, -5.79619897e+01, -2.28939575e+00,
        -7.28070688e+00,  1.39436227e+00],
       [-2.76360764e+02, -3.01686231e+01, -2.54072773e+00,
         1.19978871e+01, -6.77543893e+01,  1.84625176e+00,
        -1.01961151e+01,  3.34289566e+00],
       [-2.75313139e+02, -2.99908815e+01, -3.12515545e+00,
         1.25731284e+01, -6.90739427e+01, -1.53255429e+00,
        -7.90914045e+00,  1.64702757e+00],
       [-2.75789907e+02, -2.98709584e+01, -6.24535072e+00,
         2.82364347e+01, -3.70027253e+01, -1.27965264e+01,
         1.27465640e+01,  5.13144695e-01],
       [-2.85371071e+02, -2.97751939e+01, -8.10681918e+00,
         2.09005681e+01, -4.87754342e+01, -3.07839548e+00,
        -2.65418408e+00,  9.02388156e-01],
       [-2.73821408e+02, -2.97463361e+01, -4.20938289e+00,
         1.28956311e+01, -7.00382149e+01, -4.18794327e+00,
        -4.81860219e+00, -1.82408607e+00],
       [-2.72715677e+02, -2.96031007e+01, -6.98452417e+00,
         1.28155372e+01, -7.00766240e+01, -3.05713460e+00,
        -1.54612144e+00, -2.81061109e+00],
       [-2.97917699e+02, -2.94824992e+01, -3.15760264e+00,
         2.32397894e+01, -4.29958837e+01, -1.84442769e+00,
        -4.56017572e+00, -1.06889986e+00],
       [-3.36261653e+02, -2.88394734e+01, -6.08757174e+00,
         3.13059969e+01, -3.97212687e+01, -2.27467398e+01,
        -1.02126295e+01, -6.44559114e+00],
       [-2.79958993e+02, -2.70666318e+01, -6.67425781e+00,
         3.69614632e+01, -8.69903990e+01, -1.71606355e+01,
         9.85232052e+00, -1.63615416e+01],
       [-3.03276130e+02, -2.67470660e+01, -4.34866141e+00,
         8.48335066e+00, -5.03113697e+01, -1.06071049e+00,
        -5.24535560e+00,  5.50555911e-01],
       [-3.02667687e+02, -2.67086397e+01, -3.55008819e+00,
         1.04994314e+01, -5.79998219e+01, -3.62567843e+00,
        -5.28272436e+00, -3.17880404e+00],
       [-3.01975247e+02, -2.66424169e+01, -6.55767622e+00,
         1.04778915e+01, -5.84824500e+01, -2.00901668e+00,
        -3.23949702e+00, -2.87723251e+00],
       [-2.88703564e+02, -2.64500437e+01, -4.55209146e+00,
         1.84333656e+01, -4.91756868e+01, -7.86356178e-01,
        -5.37673598e+00, -3.33299955e-01],
       [-3.09975682e+02, -2.62897054e+01, -5.11508710e+00,
         1.39517190e+01, -2.15381953e+01, -6.33759147e+00,
         9.90074695e+00, -1.05744312e+01],
       [-3.10842789e+02, -2.62487671e+01, -7.40481292e+00,
         1.82406194e+01, -2.87055989e+01, -4.72031786e+00,
        -6.54053091e+00, -6.64578703e+00],
       [-2.79650252e+02, -2.43832245e+01, -5.16400782e+00,
         1.03244532e+01, -4.43544168e+01,  1.64806921e+00,
        -1.41385894e+01, -1.96006045e+00],
       [-3.14041481e+02, -2.38953447e+01, -3.76556833e+00,
         1.78614752e+01, -2.80091323e+01, -1.92360361e+00,
        -8.26427161e+00, -3.62086410e+00],
       [-2.77925729e+02, -2.37553558e+01, -7.03475145e+00,
         1.17063814e+01, -4.85175888e+01,  1.46277017e+00,
        -1.47604295e+01,  1.34271689e-01],
       [-2.96623483e+02, -2.36740606e+01, -5.02385116e+00,
         4.30791511e+00, -2.40558207e+01, -7.40414516e+00,
         3.03117014e+00, -1.66689927e+01],
       [-2.84781982e+02, -2.31033829e+01, -4.83933630e+00,
         1.84936028e+01, -3.67215202e+01, -1.37760715e+01,
         8.81940418e+00, -1.77845046e+01],
       [-2.65701136e+02, -2.29686545e+01, -7.10831277e+00,
         1.76538157e+01, -4.66773927e+01,  1.88115672e+00,
        -2.69332183e-01,  5.49509890e+00],
       [-3.27698997e+02, -2.29198067e+01, -2.60214178e+00,
         8.63145294e+00, -4.75210339e+01, -1.23888041e+00,
        -5.87484180e+00, -2.12573862e+00],
       [-3.27188926e+02, -2.28222622e+01, -3.44480697e+00,
         7.96336207e+00, -4.60694854e+01,  4.01727451e-01,
        -2.74851821e+00,  9.00144393e-01],
       [-3.26827270e+02, -2.27890627e+01, -4.26563224e+00,
         8.80210887e+00, -4.82764082e+01, -2.18315684e+00,
        -6.54645107e+00, -4.26909562e+00],
       [-3.26138321e+02, -2.27028802e+01, -6.80931638e+00,
         8.85834456e+00, -4.91311243e+01, -1.36967721e-01,
        -7.14409557e+00, -3.48113209e+00],
       [-2.66835166e+02, -2.23594593e+01, -5.44920485e+00,
         1.66377040e+01, -4.56220963e+01,  3.99908585e-01,
        -1.76413132e+00,  6.45123111e+00],
       [-3.14564032e+02, -2.22681070e+01, -3.38004407e+00,
         1.94661245e+00, -3.30889683e+01, -3.12892175e+00,
         2.85694762e+00, -9.89234285e+00],
       [-2.75190264e+02, -2.20664251e+01, -6.77597381e+00,
         1.39080639e+01, -5.22283451e+01, -2.11509016e-01,
        -1.44408970e+01, -1.19714771e+00],
       [-2.67544162e+02, -2.16655948e+01, -3.24677583e+00,
         1.55453861e+01, -4.42415682e+01, -5.17393544e-01,
        -2.23864706e+00,  7.90475274e+00],
       [-2.86931615e+02, -2.14677037e+01, -4.18883841e+00,
         1.30063317e+01, -2.49871840e+01, -2.54803926e+01,
        -4.60500694e+01,  6.92369806e+00],
       [-3.12653540e+02, -2.07902314e+01, -6.89362413e+00,
         1.16934425e+00, -2.74430396e+01, -4.58424620e+00,
         1.29664726e+00, -1.20018187e+01],
       [-2.74738858e+02, -2.01735522e+01, -6.75203425e+00,
         1.48629638e+01, -5.31800804e+01,  2.35826323e+00,
        -1.33597654e+01, -3.64419082e+00],
       [-2.82394766e+02, -1.88612591e+01, -7.40210001e+00,
         1.73116207e+01, -4.62789867e+01,  9.02387687e-01,
        -8.77911041e-01, -3.72326952e-01],
       [-2.77346330e+02, -1.88233172e+01, -7.96394451e+00,
         1.73941814e+01, -4.38518191e+01,  1.49660222e+00,
         1.96783362e+00, -3.22653550e+00],
       [-2.79707219e+02, -1.87876434e+01, -7.95576498e+00,
         1.75323378e+01, -4.49852965e+01,  6.00843892e-01,
         5.53657581e-01, -1.94999016e+00],
       [-2.84347710e+02, -1.85566728e+01, -6.14230280e+00,
         1.67200824e+01, -4.68213722e+01,  8.51601511e-01,
        -2.49335469e+00,  7.81149780e-01],
       [-2.85247321e+02, -1.80164172e+01, -3.89652053e+00,
         1.59581766e+01, -4.65003361e+01, -1.48961891e-02,
        -4.07758223e+00,  1.44075547e+00],
       [-2.99122336e+02, -1.73222224e+01, -2.65822011e+00,
         1.33088096e+01, -3.41615136e+01,  1.31539365e+00,
        -5.06875963e-01, -2.88480392e-01],
       [-3.06236211e+02, -1.67823383e+01, -5.79765651e+00,
         1.36273777e+01, -3.47946887e+01,  2.88194601e-01,
        -9.45472972e+00, -4.59949023e+00],
       [-3.06981318e+02, -1.67478794e+01, -8.73242380e+00,
         1.52356524e+01, -3.60698171e+01,  2.11051439e+00,
        -6.92398574e-01, -4.73796610e+00],
       [-2.86457628e+02, -1.66862724e+01, -2.84057839e+00,
         1.39133295e+01, -3.54172255e+01,  1.45489367e+00,
         3.96704264e+00,  3.27932165e+00],
       [-3.09658454e+02, -1.66119229e+01, -3.37265088e+00,
         1.01038212e+01, -2.46675296e+01,  7.10506705e-01,
        -4.03581900e+00, -4.60402744e+00],
       [-3.20024223e+02, -1.65213741e+01, -8.00504146e+00,
         1.22394369e+01, -2.63296634e+01,  1.51294285e-01,
        -6.13257936e+00, -8.61724918e+00],
       [-2.87425750e+02, -1.64488512e+01, -2.95441786e+00,
         7.39384172e+00, -3.47363481e+01, -6.57657725e+00,
         7.25049252e+00, -1.58696669e+01],
       [-2.98480060e+02, -1.63760542e+01, -3.96263951e+00,
         1.25456714e+01, -3.36183947e+01,  7.87131799e-01,
         3.34925390e-02, -1.16482661e+00],
       [-3.21906153e+02, -1.61274731e+01, -6.60035681e+00,
         1.25538769e+01, -2.65466619e+01, -5.84664589e-01,
        -6.99009873e+00, -6.89723492e+00],
       [-2.69166168e+02, -1.60981174e+01, -3.19925276e+00,
         3.01281518e+01, -6.58125523e+01, -2.79399057e-01,
        -2.47502013e+01, -7.55725548e+00],
       [-3.08907664e+02, -1.60849190e+01, -8.33353050e+00,
         1.55180522e+01, -3.63485822e+01, -2.11681548e-01,
        -1.33462699e+00, -4.04809637e+00],
       [-2.69043453e+02, -1.60620399e+01, -3.85746377e+00,
         2.78974805e+01, -6.74237549e+01,  6.48429387e-02,
        -2.26346645e+01, -1.40288103e+01],
       [-3.00970092e+02, -1.59864759e+01, -6.85338395e+00,
         1.42929767e+01, -4.07580901e+01, -7.86949538e-01,
        -1.99231776e+00, -3.64923752e+00],
       [-2.98484462e+02, -1.58587989e+01, -8.60404073e+00,
         1.42862894e+01, -3.93836209e+01, -4.40698966e-01,
        -2.06093022e-01, -4.55180741e+00],
       [-2.87482839e+02, -1.58401769e+01, -6.25268247e+00,
         3.16325661e+00, -2.51474890e+01, -3.62193439e+00,
         1.50870736e+01, -2.40719498e+01],
       [-2.79330120e+02, -1.58010245e+01, -8.23014822e+00,
         1.74819827e+01, -3.41652089e+01,  2.07968816e+00,
         8.27235322e+00,  3.23421355e+00],
       [-2.86096483e+02, -1.57492258e+01, -3.39092068e+00,
         1.28715799e+01, -3.49727747e+01,  1.37014012e+00,
         4.01044755e+00,  2.26574047e+00],
       [-3.02706780e+02, -1.57424795e+01, -4.50568379e+00,
         1.39437151e+01, -4.16668495e+01, -4.22397885e-01,
        -4.05064469e+00, -2.68261400e+00],
       [-3.23939559e+02, -1.55814274e+01, -4.32755252e+00,
         1.25489497e+01, -2.69576862e+01,  6.12402323e-01,
        -8.20049520e+00, -6.90777818e+00],
       [-2.66292732e+02, -1.55676756e+01, -7.31366730e+00,
         2.39769334e+01, -5.46553167e+01, -4.15175181e+00,
        -5.11739081e+00, -3.09221997e+00],
       [-3.08376828e+02, -1.55548367e+01, -5.32985397e+00,
         9.28278868e+00, -2.37174547e+01, -6.63946228e-02,
        -3.32020881e+00, -6.07198415e+00],
       [-2.71246249e+02, -1.55141934e+01, -4.42788458e+00,
         2.09965867e+01, -5.44899103e+01,  1.94931527e+00,
        -9.04812678e-01, -4.43128973e+00],
       [-3.10837893e+02, -1.54037405e+01, -6.93066930e+00,
         1.57371854e+01, -3.67116731e+01, -9.48127792e-01,
        -2.25165892e+00, -2.33391241e+00],
       [-2.97690467e+02, -1.53623466e+01, -4.76178688e+00,
         1.14511262e+01, -3.30003576e+01,  8.82531399e-01,
         9.47293550e-02, -2.83695011e+00],
       [-3.00751606e+02, -1.52252983e+01, -4.21535915e+00,
         8.24147923e+00, -3.70492673e+01, -2.70503759e+00,
        -5.29074820e-01, -1.05581745e+01],
       [-2.96080113e+02, -1.52166078e+01, -8.45539876e+00,
         1.68041781e+01, -3.81380526e+01, -2.48387119e-01,
         4.01128316e+00,  1.76600192e+00],
       [-2.85735530e+02, -1.48109704e+01, -3.70832577e+00,
         1.18028111e+01, -3.45387258e+01,  1.91846540e+00,
         3.78123354e+00,  1.55764955e+00],
       [-2.81238981e+02, -1.47729613e+01, -7.85415256e+00,
         1.78650285e+01, -3.53006932e+01,  2.91995936e-02,
         8.17764076e+00,  4.73854381e+00],
       [-3.12919653e+02, -1.45695527e+01, -4.66393358e+00,
         1.56547307e+01, -3.73274115e+01,  2.57044485e-01,
        -3.58085766e+00, -2.23776525e+00],
       [-2.88959806e+02, -1.45226333e+01, -4.22794385e+00,
         8.84252411e+00, -3.17490260e+01,  1.74918725e+00,
        -2.23780436e+01, -9.21655574e+00],
       [-2.97214232e+02, -1.44584009e+01, -6.24573568e+00,
         3.25216247e+01, -6.03387105e+01, -1.81325478e+00,
        -1.25117731e+01, -1.75605796e+01],
       [-3.06943592e+02, -1.44308047e+01, -6.54484387e+00,
         8.08694115e+00, -2.27677678e+01,  2.59975133e-01,
        -3.04903329e+00, -8.62730487e+00],
       [-2.96903068e+02, -1.43449138e+01, -5.09735567e+00,
         1.03198185e+01, -3.24079033e+01,  1.88103959e+00,
        -2.14248626e-01, -4.03225504e+00],
       [-2.98056693e+02, -1.42553770e+01, -7.05842947e+00,
         1.69107641e+01, -3.86057170e+01, -9.83080554e-01,
         3.46368486e+00,  3.70787251e+00],
       [-2.66025833e+02, -1.41766795e+01, -5.69885571e+00,
         1.73926727e+01, -2.60641114e+01,  1.09653030e+00,
         8.10921893e+00,  5.01609540e+00],
       [-2.69652152e+02, -1.41090399e+01, -5.76094875e+00,
         1.70423906e+01, -2.85863777e+01,  5.90700865e-01,
         1.93102420e+00, -2.79258276e+00],
       [-2.99687322e+02, -1.39511857e+01, -7.65140364e+00,
         2.17060881e+01, -3.41660852e+01,  2.07378093e+00,
        -1.24421484e+01,  4.44339465e+00],
       [-2.66268154e+02, -1.38703830e+01, -5.32136222e+00,
         1.93778164e+01, -3.43235375e+01,  2.35061173e+00,
         5.88381510e+00,  2.61030300e+00],
       [-2.98829482e+02, -1.37977688e+01, -2.53105141e+00,
         1.55299449e+01, -2.39555429e+01, -1.33029706e-01,
        -1.00616181e+00,  3.09393848e+00],
       [-3.12074647e+02, -1.37898229e+01, -7.59835288e+00,
         2.44321384e+01, -3.41547566e+01,  2.24931886e+00,
        -1.67832331e+01,  2.28605980e+00],
       [-2.88130564e+02, -1.37419653e+01, -2.40344746e+00,
         1.52511911e+01, -2.47197873e+01, -8.49930534e-01,
        -7.03554117e-01,  5.79416992e+00],
       [-2.83150592e+02, -1.37332712e+01, -6.52551109e+00,
         1.81814493e+01, -3.65019600e+01, -5.10093198e-01,
         7.57160461e+00,  7.06209826e+00]]), 
       array([1417805, 1417806, 1417678, 1147934, 1010280, 1147933, 1317109,
       1283169, 1319022, 1317108, 1147932, 1514339, 1516252, 1508600,
       1506687,  867426, 1288409, 1504774, 1502861, 1319021,  961124,
       1403388, 1516251, 1504773, 1502860, 1290322,  804273, 1317107,
       1374506, 1319020, 1372593, 1428285,  802361, 1230632, 1506685,
       1516250, 1504772, 1502859, 1232545, 1447413, 1370680, 1234458,
       1223281, 1445500, 1368767, 1228718, 1224892, 1226805, 1230631,
       1232544, 1421920, 1290321, 1431485, 1420008, 1421919, 1433397,
       1426373, 1420007, 1435310, 1224446, 1433398, 1222533, 1228717,
       1226804, 1424460, 1431487, 1418095, 1230630, 1437223, 1361115,
       1420006, 1363028, 1435311, 1418094, 1443588, 1433399, 1416182,
       1433400, 1437224, 1370679, 1086131, 1418093, 1416181, 1435312,
       1433401, 1318619, 1265449, 1362619, 1391314, 1261622, 1391315,
       1435313])]
```


3. What information is stored in the internal nodes? 




## General info

Shape of image A: (800, 1920, 3)
Shape of image B: (800, 1920, 3)
Patches created for image A: (1517009, 8, 8, 3)
Patches created for image B: (1517009, 8, 8, 3)
Subset of patches created for image A: (1000, 192)
Subset of patches created for image B: (1000, 192)
Patches reduced for image A: (1517009, 8)
Patches reduced for image B: (1517009, 8)
K-d tree has been fitted ...
Traversing sklearn
Building propagated k-d tree version ...
Going for a depth of: 15
Depth: 15





# KNN Notes

For choosing k=square root of training set size. From Fabian. This seems to be some theoretical result specific to a class of supervised learning using nn classiefiers , but in most/all practical cases one chooses k a constant

Or it can be computed by some preliminary/tunning step (think crossvaludation on a set of repræsentative input)

So I think it is safe to consider it a constant for our purposes

For the categories thing... those are also specific to classification problem

1. Most of the k-nn implementation we work on is independent of the application domain

2. But even in the patch sampling domain , it still makes sense to compute nontrivial k-nn (k>1)
	
	1. in the presentation they are saying they use the pixel with a similar neighborhood to fill in the image or some such —- the neighborhood is more exact if more than one neighbor are considered probably , so in my mind k>1 makes sense. Similarly if you google “texture synthesis” and search nearest neighbor ... the same “local neighborhood” idea comes up.

	2. particular to the “propagation” algorithm : computing k-nn with k>1 allows one to propagate more leafs in which each patch on the next row searches his nearest neighbors so it might improve performance

	3. and as you are pointing out patches are overlapping hence similar , so there might be many instances of the same nearest neighbour (maybe it’s useful somehow to know how many exact matches and where they are situated )


What I’m pointing out is that even if you just need K=1 as a final result , computing with a greater K might still be beneficial because of the “propagation” phase (k>1 will increase the chances of having several leaves as candidates rather than just 1)




